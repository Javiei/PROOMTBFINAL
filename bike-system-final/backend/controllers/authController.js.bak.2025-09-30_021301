
/*__LOGIN_HELPERS__*/
const comparePasswordFlexible = async (plain, stored) => {
  try {
    if (typeof stored === 'string' && stored.startsWith('$2')) {
      return await bcrypt.compare(plain, stored); // bcrypt
    }
  } catch (e) {}
  return plain === stored; // texto plano legacy
};
/*__LOGIN_HELPERS__*/

import bcrypt from 'bcryptjs';
import db from '../db.js';

export const loginUser = (req, res) => {
  const { userId, password } = req.body;

  db.query(
    'SELECT * FROM users WHERE id = ? AND password = ?',
    [userId, password],
    (err, results) => {
      if (err) {
        console.error('❌ Error SQL Login:', err);  // <-- NUEVO
        return res.status(500).json({ error: 'Error de servidor' });
      }

      if (results.length > 0) {
        const user = results[0];
        res.json({ id: user.id, name: user.name, role: user.role });
      } else {
        res.status(401).json({ error: 'Credenciales incorrectas' });
      }
    }
  );
};
